---
title: "Manejo de Florestas Plantadas"
---

# Manejo de Florestas Plantadas

## Altura Dominante

A altura dominante, que representa a média das alturas das árvores mais altas e/ou mais grossas de um determinado número de árvores por hectare, é menos influenciada por variações de densidade e competições locais entre árvores menores, tornando-a uma medida confiável da qualidade do sítio. Com ela, é possível estimar o potencial de crescimento da floresta, modelar curvas de crescimento e projetar a produção futura, auxiliando no planejamento sustentável e na tomada de decisões estratégicas no manejo florestal.

<br>

Dados exemplo:
[Baixar dados](data/DesafioCalcHdom.csv)

```{r, echo=FALSE, message=FALSE, warning=FALSE}
#install.packages("kableExtra")

BD <- read.csv2("data/DesafioCalcHdom.csv")

library(kableExtra)

# Exibir o data.frame com formatação extra
head(BD) %>%
  knitr::kable() %>%
  kableExtra::kable_styling(full_width = FALSE, bootstrap_options = c("striped", "hover"))
```

### Calculando altura dominante por parcela (Assman)
```{r}

BD <- read.csv2("data/DesafioCalcHdom.csv")
colnames(BD)[1] = c("areaParc")
BD <- BD[, 1:5]
BD <- BD[order(BD$Parc, BD$DAP, decreasing = TRUE),]
row.names(BD) <- NULL

Parc <- unique(BD$Parc)
Hdom_assman <- unique(BD$Parc)

j <- 1
for (i in Parc) {
  a <- ceiling(mean(BD[which(BD$Parc==i),1])*100/10000)
  H <- BD[which(BD$Parc==i),5]
  Hdom_assman[j] <- round(mean(H[1:a]), 2)
  j <- j+1
}

BD2 <- as.data.frame(cbind(Parc, Hdom_assman))
BD <- merge(BD, BD2)

```

<br>
Resultado:

```{r, echo=FALSE, message=FALSE, warning=FALSE}
library(kableExtra)

# Exibir o data.frame com formatação extra
BD2 %>%
  knitr::kable() %>%
  kableExtra::kable_styling(full_width = FALSE, bootstrap_options = c("striped", "hover"))

```

#### Exercício

Faça o cálculo da altura dominante agora seguindo o conceito de Hart: 100 árvores mais altas por hectare.

<button class="custom-toggle-btn">Mostrar solução</button>
<div class="custom-toggle-content" style="display: none;">

  Solução do problema sem o pipe


  ```{r}
  
  BD <- read.csv2("data/DesafioCalcHdom.csv")
  colnames(BD)[1] = c("areaParc")
  BD <- BD[, 1:5]
  BD <- BD[order(BD$Parc, BD$Ht, decreasing = TRUE),]
  row.names(BD) <- NULL

  Parc <- unique(BD$Parc)
  Hdom_hart <- unique(BD$Parc)

  j <- 1
  for (i in Parc) {
    a <- ceiling(mean(BD[which(BD$Parc==i),1])*100/10000)
    H <- BD[which(BD$Parc==i),5]
    Hdom_hart[j] <- round(mean(H[1:a]), 2)
    j <- j+1
  }

  BD2 <- as.data.frame(cbind(Parc, Hdom_hart))
  BD <- merge(BD, BD2)


  ```

  Resultado:
  ```{r, echo=FALSE, message=FALSE, warning=FALSE}
  library(kableExtra)

  # Exibir o data.frame com formatação extra
  BD2 %>%
    knitr::kable() %>%
    kableExtra::kable_styling(full_width = FALSE, bootstrap_options = c("striped", "hover"))
  ```

  Solução com pipe

  ```{r}
  library(dplyr)

  BD <- BD %>%
    arrange(Parc, desc(Ht))  # Garantir a ordem correta

  BD_Hart <- BD %>%
    group_by(Parc) %>%
    mutate(
      num_top = ceiling(mean(areaParc) * 100 / 10000)
    ) %>%
    slice(1:first(num_top)) %>%
    summarise(
      Hdom_Hart2 = round(mean(Ht, na.rm = TRUE), 2)
    ) %>%
    ungroup()

  BD_HDOM <- merge(BD2, BD_Hart, by = "Parc")

  ```

  Resultado:
  ```{r, echo=FALSE, message=FALSE, warning=FALSE}
  library(kableExtra)

  # Exibir o data.frame com formatação extra
  BD_HDOM %>%
    knitr::kable() %>%
    kableExtra::kable_styling(full_width = FALSE, bootstrap_options = c("striped", "hover"))
  ```
</div>
