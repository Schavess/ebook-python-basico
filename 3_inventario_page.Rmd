---
title: "Inventário Florestal"
---


# Inventário florestal
Este capítulo apresenta uma abordagem prática para a aplicação da linguagem R na solução de problemas típicos de inventário florestal. O foco está na integração de métodos estatísticos com ferramentas computacionais eficientes, permitindo aos profissionais otimizar processos de coleta, organização e interpretação de dados florestais. Exemplos práticos e scripts comentados são fornecidos, visando uma aplicação direta ao contexto profissional, com ênfase em replicabilidade e adaptação às diversas realidades do setor florestal.

## Fitossociologia
Os engenheiros florestais realizam estudos de fitossociologia para compreender a composição, a estrutura e as interações das comunidades vegetais em um determinado ecossistema. Esses estudos permitem identificar espécies dominantes, associadas e raras, além de avaliar a biodiversidade e as dinâmicas ecológicas do ambiente. Essas informações são essenciais para planejar o manejo sustentável, recuperar áreas degradadas e conservar ecossistemas naturais.

Os engenheiros florestais realizam estudos de fitossociologia para determinar tipologias vegetais e fitofisionomias, aspectos fundamentais em processos como a Autorização para Exploração Vegetal (AUTEX) e os Programas de Recuperação Ambiental (PRA).


### Teoria
#### Estrutura horizontal

##### Densidade absoluta
Refere-se ao número de indivíduos de uma espécie \(i\) (\(n_i\)) por unidade de área (\(A\)), expressando a abundância total da espécie na comunidade.

$$
DA_i = \frac{n_i}{A}
$$

##### Densidade relativa
É a proporção da densidade absoluta de uma espécie (\(DA_i\)) em relação à soma das densidades absolutas de todas as espécies, expressa em porcentagem. Indica a importância relativa da espécie em termos de abundância.

$$
DR_i = \frac{DA_i}{\sum_{i=1}^s (DA_i)}
$$

##### Dominância absoluta
Calcula a área basal total (\(G_i\)) de todos os indivíduos de uma espécie por unidade de área (\(A\)). Mede o espaço físico ocupado por uma espécie no ambiente.

$$
DoA_i = \frac{\sum_{j=1}^{n_i} g_j}{A} = \frac{G_i}{A}
$$

##### Dominância relativa
Representa a proporção da dominância absoluta de uma espécie (\(DoA_i\)) em relação à dominância total (\(G_T\)) de todas as espécies, expressa em porcentagem. Indica a importância relativa em termos de área ocupada.

$$
DoR_i = \frac{DoA_i}{\sum_{i=1}^{S} (DoA_i)}*100=\frac{G_i}{G_T}*100
$$

##### Frequência Absoluta
É a relação entre o número de unidades amostrais onde a espécie está presente (\(U_i\)) e o total de unidades amostrais (\(U_T\)), expressa em porcentagem. Mede a distribuição da espécie no espaço amostrado.

$$
FA_i = \frac{U_i}{U_T}*100
$$

##### Frequência Relativa
Corresponde à frequência absoluta de uma espécie (\(FA_i\)) em relação à soma das frequências absolutas de todas as espécies, expressa em porcentagem. Avalia a importância espacial relativa da espécie.

$$
FR_i = \frac{FA_i}{\sum_{i=1}^{S}(FA_i)}*100
$$

##### Valor de Cobertura
É a soma da densidade relativa (\(DR_i\)), da dominância relativa (\(DoR_i\)) e, em alguns casos, da frequência relativa (\(FR_i\)), dependendo da metodologia. Reflete a contribuição total de uma espécie na comunidade.
$$
VC_i = DR_i + DoR_i + FR_i
$$

##### Porcentagem de Cobertura (Horizontal)
É a média ponderada de densidade relativa, dominância relativa e, opcionalmente, frequência relativa. A interpretação pode variar entre o cálculo bidimensional (\(DR + DoR\)) ou tridimensional (\(DR + DoR + FR\)), dependendo do objetivo.
$$
PC_i = \frac{DR_i + DoR_i + FR_i}{3}
$$

#### Diversidade

##### Índice de Shannom
Quantifica a diversidade da comunidade, considerando tanto a abundância (\(p_i\)) quanto a equitabilidade das espécies. Valores maiores indicam maior diversidade e distribuição equitativa entre as espécies.

$$
H' = -\sum_{i=1}^S p_i \ln(p_i)
$$

#### Agregação
##### Índice de Morisita
Mede o padrão de distribuição espacial das espécies. Valores \(I_\delta > 1\) indicam agregação, \(I_\delta = 1\) distribuição ao acaso, e \(I_\delta < 1\) distribuição uniforme.

$$
I_\delta = \frac{n \sum_{i=1}^S n_i (n_i - 1)}{N (N - 1)}
$$

#### Estrutura vertical
##### Posição Sociológica Absoluta
Representa a distribuição vertical de uma espécie na comunidade, considerando a contribuição proporcional das classes de altura.
$$
PSA_i = \sum_{j=1}^{J}\left(\frac{N_j}{N} \cdot N_{ij}\right)
$$

##### Posição Sociológica Relativa
É a proporção da posição sociológica absoluta de uma espécie (\(PSA_i\)) em relação à soma das posições sociológicas absolutas de todas as espécies, expressa em porcentagem. Indica a importância relativa da espécie na estrutura vertical.
$$
PSR_i = \frac{PSA_i}{\sum_{i=1}^{S} PSA_i} \cdot 100
$$

##### Valor de Importância Absoluta (Horizontal + Vertical)
Combina os índices horizontais (densidade relativa, dominância relativa e frequência relativa) com a posição sociológica absoluta para refletir a contribuição global de uma espécie na comunidade.
$$
VI_a = DR_i + DoR_i + FR_i + PSA_i
$$

##### Valor de Importância Relativa (Horizontal + Vertical)
É a média ponderada dos índices horizontais e verticais. Indica a importância relativa de uma espécie considerando a estrutura horizontal e vertical.
$$
VI_r = \frac{DR_i + DoR_i + FR_i + PSA_i}{4}
$$

#### Regeneração
Pode-se usar os mesmos índices anteriores de estrutura horizontal, vertical, etc. O resultado final será o Indicador de Regeneração Natural que poderá ser usado para calcular o **Valor de Importância Ampliado**:
$$
VIA_r = \frac{DR_i + DoR_i + FR_i + PSA_i + RN_i}{5}
$$

### Aplicação

De acordo com o estudo realizado por Verly et al. (2020), a caracterização florística defina para a Reserva Legal do IFMT foi de um fragmento Cerradão em estado de conservação adequada.
De acordo com [@verly2020], a caracterização florística...


Dados exemplo:
[Baixar dados](data/Dados_Reserva_Exemplo.xlsx)

```{r, echo=FALSE, message=FALSE, warning=FALSE}
library(readxl)
library(kableExtra)
library(dplyr)
library(data.table)
library(DT)

BD <- read_excel("data/Dados_Reserva_Exemplo.xlsx")



if (knitr::is_html_output()) {
  datatable(BD, options = list(columnDefs = list(list(orderable = FALSE, targets = "_all"))))
}

# Exibir tabela estática formatada para PDF
if (knitr::is_latex_output()) {
  knitr::kable(BD, format = "latex", booktabs = TRUE) %>%
    kable_styling(latex_options = c("striped", "scale_down")) %>%
    column_spec(1, width = "3cm") %>%
    column_spec(2, width = "5cm") %>%
    landscape()

}
```
<br>

#### Consistência dos dados
Antes de qualquer análise, é fundamental verificar a consistência dos dados coletados. Isso envolve identificar e corrigir possíveis erros ou inconsistências, garantindo a qualidade e a confiabilidade das informações para as análises subsequentes.
```{r}
items_excluir <- c("SP", "Morta", "PP", "PS", "Repetida", "Repitida", "Morfoespécie 1", "Morfoespécie 7", "Morfoespécie 8", "Fabaceae 1")
BD_ <- BD[!BD$`Nome Científico` %in% items_excluir, ]

BD_$DAP <- as.numeric(BD_$DAP)
BD_$`H T` <- as.numeric(BD_$`H T`)
```

#### Distribuição diamétrica geral
A análise da distribuição dos diâmetros das árvores fornece insights sobre a estrutura etária e o desenvolvimento da floresta. Uma distribuição equilibrada indica uma regeneração contínua, enquanto a predominância de árvores em determinadas classes diamétricas pode sugerir distúrbios ou práticas de manejo específicas.
```{r}
intervalo <- 5
max_d <- ceiling(max(BD_$DAP, na.rm = TRUE))
intervalos <- seq(0, max_d + intervalo, by = intervalo)
hist(BD_$DAP, breaks = intervalos, main = NULL, xlab = "Diâmetro (cm)", ylab = "Frequência")
```
<br>

#### Distribuição por espécies (boxplots)
Os boxplots permitem visualizar a variação dos diâmetros por espécie, destacando tendências e identificando outliers. Essa análise auxilia na compreensão do crescimento e do desenvolvimento de cada espécie, bem como na identificação de espécies que possam necessitar de atenção especial no manejo.

##### Boxplot dos DAPs
```{r}
require(ggplot2)
especies <- unique(BD_$`Nome Científico`)

p <- ggplot(BD_, aes(x = reorder(`Nome Científico`, DAP, median), y = DAP, fill = `Nome Científico`)) +
  geom_boxplot(outlier.shape = NA) +  # Boxplot sem os outliers
  theme_minimal(base_size = 10) +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1, size = 6),
    legend.position = "none"  # Remover legenda, se preferir
  ) +
  labs(title = "Distribuição dos DAPs por Espécie", 
       x = "Espécies", y = "DAP (cm)")

print(p)
```

##### boxplot das alturas totais

```{r}

p <- ggplot(BD_, aes(x = reorder(`Nome Científico`, `H T`, median), y = `H T`, fill = `Nome Científico`)) +
  geom_boxplot(outlier.shape = NA) +  # Boxplot sem os outliers
  theme_minimal(base_size = 10) +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1, size = 6),
    legend.position = "none"  # Remover legenda, se preferir
  ) +
  labs(title = "Distribuição das HTs por Espécie", 
       x = "Espécies", y = "HT (m)")

print(p)
```
<br>

#### Parâmetros Fitossociológicos
A aplicação prática dos parâmetros fitossociológicos, como densidade, dominância e frequência, fornece uma visão detalhada da composição e da estrutura da comunidade vegetal. Esses indicadores são essenciais para o planejamento de ações de manejo, conservação e recuperação de áreas florestais.

##### Estrutura horizontal

```{r}

EH <- function(species, sample, d, A) {
    DT <- data.table(species = species, sample = sample, d = d)
    DT <- DT[, `:=`(gi = pi * d^2 / 40000)]
    Ui <- unique(DT, by = c("species", "sample"))[, .(Ui = .N), by = "species"]
    ni <- DT[, .(ni = .N, Gi = sum(gi)), by = "species"]
    ni <- ni[Ui, on = "species"]
    ni[, DAi := ni / A][, DRi := (DAi / sum(DAi)) * 100]
    ni[, DoAi := Gi / A][, DoRi := (DoAi / sum(DoAi)) * 100]
    ni[, FAi := (Ui / length(unique(DT$sample))) * 100][, FRi := (FAi / sum(FAi)) * 100]

    num_cols <- names(ni)[sapply(ni, is.numeric)]
    ni[, (num_cols) := lapply(.SD, round, 4), .SDcols = num_cols]

    setnames(ni, old = "species", new = "Espécies")

    return(ni)
}

EH_result <- EH(BD_$`Nome Científico`, BD_$Parc, BD_$DAP, A = 0.8)
```
Resultados:

```{r, echo=FALSE, message=FALSE, warning=FALSE}

# Para HTML: Tabela interativa
if (knitr::is_html_output()) {
  datatable(
    EH_result, 
    options = list(
      scrollX = TRUE,                             # Ativar scroll horizontal
      columnDefs = list(
        list(orderable = FALSE, targets = "_all"),# Desativar ordenação em todas as colunas
        list(className = "dt-center", targets = "_all") # Centralizar conteúdo
      ),
      pageLength = 10                             # Exibir 10 linhas por página
    )
  )
}

# Para PDF: Tabela estática formatada
if (knitr::is_latex_output()) {
  knitr::kable(EH_result, format = "latex", booktabs = TRUE) %>%
    kable_styling(latex_options = c("striped", "scale_down")) %>%
    column_spec(1, width = "3cm") %>%
    column_spec(2, width = "5cm") %>%
    landscape()
}
```
<br>

##### Índice de Shannon (Diversidade)
Na aplicação, o cálculo do índice de Shannon avalia a diversidade alfa da comunidade vegetal. Um valor alto reflete maior diversidade e distribuição equitativa entre as espécies no local estudado.

```{r}
shannon <- function(species_counts) {
  pi <- species_counts / sum(species_counts)
  -sum(pi * log(pi), na.rm = TRUE)
}

H <- shannon(EH_result$ni)
cat("Índice de Shannon:", H, "\n")

```
##### Índice de Morisita (Agregação)
Mede o padrão de distribuição espacial das espécies. Valores \(I_\delta > 1\) indicam agregação.

```{r}
morisita <- function(species_counts, parcelas) {
  # Agregar os indivíduos por parcela
  counts <- tapply(species_counts, parcelas, sum)
  
  N <- sum(counts)       # Total de indivíduos em todas as parcelas
  n <- length(counts)    # Número de parcelas
  numerator <- n * sum(counts * (counts - 1))  # Soma dos xi(xi - 1) por parcela
  denominator <- N * (N - 1)                   # Total de combinações possíveis
  I_M <- numerator / denominator
  return(I_M)
}

# Exemplo de aplicação:
# Substituir species_counts e parcelas pelos dados reais
species_counts <- BD_$DAP[!is.na(BD_$DAP)]  # DAP como proxy de presença/indivíduo
parcelas <- BD_$Parc                       # Número da parcela correspondente
I_delta <- morisita(species_counts, parcelas)
cat("Índice de Morisita corrigido:", I_delta, "\n")


```
##### Estrutura vertical e classificação em estratos
A inclusão da dimensão vertical nos parâmetros fitossociológicos agrega uma visão tridimensional da comunidade florestal, indo além da análise convencional baseada apenas na densidade e dominância (horizontal).

```{r}
BD_$`H T` <- as.numeric(BD_$`H T`)
meanH <- mean(BD_$`H T`, na.rm = TRUE)
sdH <- sd(BD_$`H T`, na.rm = TRUE)

# Calcular estrato
BD_$estrato <- case_when(
  BD_$`H T` < (meanH - sdH) ~ "Inferior",
  BD_$`H T` >= (meanH - sdH) & BD_$`H T` <= (meanH + sdH) ~ "Médio",
  BD_$`H T` > (meanH + sdH) ~ "Superior"
)

# Calcular PSAi e PSRi
resultados <- BD_ %>%
  group_by(estrato) %>%
  mutate(
    Nj = n(),                     # Total de indivíduos no estrato
    N = nrow(BD_),                # Total de indivíduos na floresta
    Pj = Nj / N                   # Peso do estrato no total
  ) %>%
  group_by(`Nome Científico`, estrato) %>%
  summarise(
    Nji = n(),                    # Número de indivíduos da espécie no estrato
    Nj = first(Nj),               # Total de indivíduos no estrato
    Pj = first(Pj),               # Peso do estrato
    PSAi_partial = (Nji / Nj) * Pj, # Contribuição parcial para PSAi
    .groups = "drop"
  ) %>%
  group_by(`Nome Científico`) %>%
  summarise(
    PSAi = sum(PSAi_partial, na.rm = TRUE)        # Soma das contribuições parciais para PSAi
  ) %>%
  ungroup() %>%
  mutate(
    PSRi = (PSAi / sum(PSAi, na.rm = TRUE)) * 100 # PSRi como porcentagem global
  )

# Fusão das tabelas com left_join
EH_result <- EH_result %>%
  left_join(resultados, by = c("Espécies" = "Nome Científico"))

# Adicionando o Valor de Importância Ampliado (VIA)
required_cols <- c("DAi", "DoAi", "FAi", "PSAi", "DRi", "DoRi", "FRi", "PSRi")
missing_cols <- required_cols[!required_cols %in% names(EH_result)]

if (length(missing_cols) > 0) {
  stop(paste("Colunas ausentes em `EH_result`: ", paste(missing_cols, collapse = ", ")))
}

EH_result <- EH_result %>%
  mutate(
    VIAa = (DAi + DoAi + FAi + PSAi) / 4,  # Cálculo do VIA absoluto
  )

# Visualizar os resultados finais com arredondamento
resultado_final <- EH_result %>%
  arrange(desc(VIAa)) %>%
  mutate(across(where(is.numeric), round, 4))


```

```{r, echo=FALSE, message=FALSE, warning=FALSE}

# Para HTML: Tabela interativa
if (knitr::is_html_output()) {
  datatable(
    resultado_final, 
    options = list(
      scrollX = TRUE,                             # Ativar scroll horizontal
      columnDefs = list(
        list(orderable = FALSE, targets = "_all"),# Desativar ordenação em todas as colunas
        list(className = "dt-center", targets = "_all") # Centralizar conteúdo
      ),
      pageLength = 10                             # Exibir 10 linhas por página
    )
  )
}

# Para PDF: Tabela estática formatada
if (knitr::is_latex_output()) {
  knitr::kable(resultado_final, format = "latex", booktabs = TRUE) %>%
  kable_styling(latex_options = c("striped", "scale_down")) %>%
  column_spec(1, width = "3cm") %>%
  column_spec(2, width = "5cm") %>%
  landscape()

}
```
<br>
Na aplicação prática, a utilização do VIA, que combina parâmetros horizontais e verticais com indicadores de regeneração, fornece uma visão holística da importância das espécies. Isso é fundamental para identificar não apenas as espécies dominantes atuais, mas também aquelas com maior potencial de contribuir para a sustentabilidade futura do ecossistema.

## Amostragem em Conglomerados 
A amostragem em conglomerados é uma técnica de amostragem probabilística usada quando a população é grande e geograficamente dispersa. Em vez de selecionar indivíduos diretamente, a população é dividida em grupos chamados conglomerados (geralmente baseados em critérios como localização ou características naturais). Em seguida, alguns conglomerados são escolhidos aleatoriamente, e todos os indivíduos ou uma amostra dentro desses conglomerados são avaliados.

Essa abordagem é eficiente em termos de custo e logística, especialmente em estudos em áreas extensas, mas pode introduzir maior variabilidade nos resultados, dependendo da homogeneidade dos conglomerados.

### Teoria

#### Média da população
$$\bar{x} = \frac{\sum_{i=1}^n \sum_{j=1}^m \left( x_{ij} \right)}{n \cdot m}$$

#### Média por subunidadae
$$\bar{x}_i = \frac{\sum_{j=1}^m x_{ij}}{m}$$

#### Variância total
$$S_x^2 = S_e^2 + S_d^2$$

#### Variância dentro do conglomerado
$$S_d^2 = QM_{dentro} = \frac{\sum_{i=1}^n \sum_{j=1}^m \left( x_{ij} - \bar{x}_i \right)^2}{n \cdot (m - 1)}$$

#### Variância entre conglomerados
$$QM_{entre} = \frac{\sum_{i=1}^n m \cdot \left( \bar{x}_i - \bar{x} \right)^2}{n - 1}$$

#### Variância entre e dentro
$$S_e^2 = \frac{QM_{entre} - QM_{dentro}}{m}$$

#### Coeficiente de correlação intraconglomerado
$$\rho = r = \frac{S_e^2}{S_e^2 + S_d^2}$$

#### Intensidade amostral requerida
$$n = \frac{t^2 \cdot S_x^2}{E^2 \cdot M} \cdot \left[ 1 + r \cdot (M - 1) \right]$$

#### Variância total
$$S_x^2 = S_e^2 + S_d^2$$

#### Variância da média
$$S_{\bar{x}}^2 = \frac{N - n}{N} \cdot \frac{S_e^2}{n} + \frac{M - m}{M} \cdot \frac{S_d^2}{n \cdot m}$$

ou

$$S_{\bar{x}}^2 = \frac{S_x^2}{n \cdot M} \cdot \left[ 1 + r \cdot (M - 1) \right]$$


#### Erro padrão
$$S_{\bar{x}} = \sqrt{S_{\bar{x}}^2}$$

#### Erro da amostragem absoluto
$$S_{\bar{x}} = \sqrt{S_{\bar{x}}^2}$$

#### Erro de amostragem relativo
$$E_r = \pm \frac{t \cdot S_{\bar{x}}}{\bar{x}} \cdot 100$$

#### Intervalo de confiança para Média
$$IC\left[\bar{x} - (E_a) \leq \bar{x} \leq \bar{x} + (E_a)\right] = P$$

#### Estimativa Total
$$\hat{X} = N \cdot M \cdot \bar{x}$$

#### Intervalo de confiança total
$$IC\left[\hat{X} - N \cdot M \cdot (E_a) \leq \hat{X} \leq \hat{X} + N \cdot M \cdot (E_a)\right] = P$$

### Aplicação
Este exemplo se baseia no Capítulo 9 de [@pellico_brena_inventario].

#### Definição dos parâmetros iniciais
```{r}
# Área Total
AREA_TOTAL <- 4000

# Tamanho da subunidade
a_sub <- 0.25

# Tamanho da Unidade
a_unidade <- 0.25 * 4

# Número de parcelas cabíveis
N <- AREA_TOTAL / a_sub
n_primaria <- 25
n_secundaria <- 4
```

#### Dados do Livro

```{r}
library(dplyr)

# Criando as unidades primárias e subunidades
unidades <- expand.grid(
  Unidade_Primaria = 1:25,  # 25 unidades primárias
  Unidade_Secundaria = 1:4  # 4 subunidades por unidade
)

# Criando o vetor de volumes (m³/0,1 ha) na ordem por coluna da tabela original
volumes <- c(
  # Coluna I
  84.7, 70.1, 75.6, 81.3, 99.5, 97.3, 70.2, 81.7, 60.9, 67.3, 
  75.4, 71.0, 61.8, 116.9, 56.0, 68.2, 55.4, 55.0, 78.8, 33.6, 
  48.8, 82.4, 69.8, 58.4, 27.4,
  # Coluna II
  78.2, 65.4, 77.7, 38.7, 47.0, 66.1, 43.5, 68.8, 71.4, 90.5, 
  88.5, 57.0, 100.9, 91.0, 22.9, 32.5, 61.3, 63.0, 59.6, 44.4, 
  26.6, 61.8, 49.5, 61.5, 63.6,
  # Coluna III
  63.0, 59.6, 66.1, 62.8, 82.1, 57.4, 48.3, 22.6, 75.2, 72.6, 
  104.6, 79.3, 69.4, 36.9, 94.8, 68.2, 76.3, 56.8, 68.1, 34.1, 
  67.5, 23.4, 53.9, 45.5, 69.4,
  # Coluna IV
  88.5, 58.1, 43.5, 31.1, 77.4, 113.9, 69.3, 78.2, 81.1, 67.1, 
  105.5, 71.8, 61.0, 57.3, 130.2, 58.6, 40.0, 36.8, 46.8, 79.6, 
  51.0, 47.1, 0.0, 50.2, 60.8
)

# Combinando os dados em um data frame
dados <- data.frame(unidades, Volume = volumes)

# Ordenando dados
dados <- dados %>% arrange(Unidade_Primaria, Unidade_Secundaria)

```
```{r, echo=FALSE, message=FALSE, warning=FALSE}

# Para HTML: Tabela interativa
if (knitr::is_html_output()) {
  datatable(
    dados, 
    options = list(
      scrollX = TRUE,                             # Ativar scroll horizontal
      columnDefs = list(
        list(orderable = FALSE, targets = "_all"),# Desativar ordenação em todas as colunas
        list(className = "dt-center", targets = "_all") # Centralizar conteúdo
      ),
      pageLength = 10                             # Exibir 10 linhas por página
    )
  )
}

```

#### Estatísticas Descritivas

```{r}


# Volume médio
v_medio <- mean(dados$Volume)

# Volume médio por parcela
v_medio_parc <- dados %>%
  group_by(Unidade_Primaria) %>%
  summarise(v_parc = mean(Volume))
  
# Variância da população
var(dados$Volume)

```
#### Estatísticas para Conglomerados

```{r}

# Quadrado Médio entre Conglomerados
QM_entre <- sum((v_medio_parc$v_parc-mean(v_medio_parc$v_parc))^2)*(n_secundaria/(n_primaria-1))
QM_entre

# Variância detro do Conglomerado
resultado <- merge(dados, v_medio_parc, by="Unidade_Primaria")
resultado$desv_quad_sub <- (resultado$Volume-resultado$v_parc)^2
var_dentro <- sum(resultado$desv_quad_sub)/(n_primaria*(n_secundaria-1))
var_dentro

# Variância entre conglomerados
var_entre <- (QM_entre-var_dentro)/n_secundaria
var_entre

# Variância Total
Var_total <- var_dentro + var_entre
Var_total

# Coeficiente de Correlação intraconglomerado
r <- var_entre/(var_entre+var_dentro)
r

```

#### Intensidade amostral requerida

```{r}

# Passo 1: t tabelado para (0.05; 24; bicaudal)
t_24 <- qt(0.05 / 2, df = 24, lower.tail = FALSE)

# Cálculo inicial para o número de parcelas requerido (n1)
n1 <- as.integer(t_24^2 * Var_total / ((0.1 * v_medio)^2 * n_secundaria) * (1 + r * (n_secundaria - 1)))
gl1 <- n_primaria - 1  # Graus de liberdade para n1

# Passo 2: Recalcular com graus de liberdade ajustados (n2)
gl2 <- n1 - 1
t2 <- qt(0.05 / 2, df = gl2, lower.tail = FALSE)
n2 <- as.integer(t2^2 * Var_total / ((0.1 * v_medio)^2 * n_secundaria) * (1 + r * (n_secundaria - 1)))

# Passo 3: Novo ajuste com graus de liberdade para n2 (n3)
gl3 <- n2 - 1
t3 <- qt(0.05 / 2, df = gl3, lower.tail = FALSE)
n3 <- as.integer(t3^2 * Var_total / ((0.1 * v_medio)^2 * n_secundaria) * (1 + r * (n_secundaria - 1)))

# Resultado final: Média entre n2 e n3 como estimativa final de parcelas requeridas
p <- ceiling(mean(c(n2, n3)))

# Exibir o resultado
cat("Número de parcelas requeridas:", p, "\n")

```

#### Estimativas Populacionais
```{r}

# Variância da média
var_media <- (Var_total/(n_primaria*n_secundaria))*(1+r*(n_secundaria-1))
var_media

# Erro padro
erro_padrao <- sqrt(var_media)
erro_padrao

# t tabelado (0.05; 24; bicaudal)
t_24 <- qt(0.05 / 2, df = 24, lower.tail = FALSE)

# Erro absoluto
Ea <- t_24 * erro_padrao
Ea

# Erro relativo
Er <- Ea/v_medio*100

cat("Erro relativo do Inventário: +-", Er, " %")

# IC média
IC_media <- c(v_medio-Ea, v_medio+Ea)

# Volume Total
VT <- v_medio*N

cat("Volume Total Estimado: ", VT, "m³")

# Intervalo de Confiança Total
IC_total <- IC_media*N

cat("IC = [", IC_total[1], " - ", IC_total[2], "] = Prob. de 95% de Confiança")
```