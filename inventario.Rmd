---
nocite: |
  @verly2020cerradao
split_bib: false
---


# Inventário florestal

## Fitossociologia (Teoria)
Os engenheiros florestais realizam estudos de fitossociologia para compreender a composição, a estrutura e as interações das comunidades vegetais em um determinado ecossistema. Esses estudos permitem identificar espécies dominantes, associadas e raras, além de avaliar a biodiversidade e as dinâmicas ecológicas do ambiente. Essas informações são essenciais para planejar o manejo sustentável, recuperar áreas degradadas e conservar ecossistemas naturais.

Os engenheiros florestais realizam estudos de fitossociologia para determinar tipologias vegetais e fitofisionomias, aspectos fundamentais em processos como a Autorização para Exploração Vegetal (AUTEX) e os Programas de Recuperação Ambiental (PRA).

### Estrutura horizontal

#### Densidade absoluta
Refere-se ao número de indivíduos de uma espécie \(i\) (\(n_i\)) por unidade de área (\(A\)), expressando a abundância total da espécie na comunidade.

$$
DA_i = \frac{n_i}{A}
$$

#### Densidade relativa
É a proporção da densidade absoluta de uma espécie (\(DA_i\)) em relação à soma das densidades absolutas de todas as espécies, expressa em porcentagem. Indica a importância relativa da espécie em termos de abundância.

$$
DR_i = \frac{DA_i}{\sum_{i=1}^s (DA_i)}
$$

#### Dominância absoluta
Calcula a área basal total (\(G_i\)) de todos os indivíduos de uma espécie por unidade de área (\(A\)). Mede o espaço físico ocupado por uma espécie no ambiente.

$$
DoA_i = \frac{\sum_{j=1}^{n_i} g_j}{A} = \frac{G_i}{A}
$$

#### Dominância relativa
Representa a proporção da dominância absoluta de uma espécie (\(DoA_i\)) em relação à dominância total (\(G_T\)) de todas as espécies, expressa em porcentagem. Indica a importância relativa em termos de área ocupada.

$$
DoR_i = \frac{DoA_i}{\sum_{i=1}^{S} (DoA_i)}*100=\frac{G_i}{G_T}*100
$$

#### Frequência Absoluta
É a relação entre o número de unidades amostrais onde a espécie está presente (\(U_i\)) e o total de unidades amostrais (\(U_T\)), expressa em porcentagem. Mede a distribuição da espécie no espaço amostrado.

$$
FA_i = \frac{U_i}{U_T}*100
$$

#### Frequência Relativa
Corresponde à frequência absoluta de uma espécie (\(FA_i\)) em relação à soma das frequências absolutas de todas as espécies, expressa em porcentagem. Avalia a importância espacial relativa da espécie.

$$
FR_i = \frac{FA_i}{\sum_{i=1}^{S}(FA_i)}*100
$$

#### Valor de Cobertura
É a soma da densidade relativa (\(DR_i\)), da dominância relativa (\(DoR_i\)) e, em alguns casos, da frequência relativa (\(FR_i\)), dependendo da metodologia. Reflete a contribuição total de uma espécie na comunidade.
$$
VC_i = DR_i + DoR_i + FR_i
$$

#### Porcentagem de Cobertura (Horizontal)
É a média ponderada de densidade relativa, dominância relativa e, opcionalmente, frequência relativa. A interpretação pode variar entre o cálculo bidimensional (\(DR + DoR\)) ou tridimensional (\(DR + DoR + FR\)), dependendo do objetivo.
$$
PC_i = \frac{DR_i + DoR_i + FR_i}{3}
$$

### Diversidade

#### Índice de Shannom
Quantifica a diversidade da comunidade, considerando tanto a abundância (\(p_i\)) quanto a equitabilidade das espécies. Valores maiores indicam maior diversidade e distribuição equitativa entre as espécies.

$$
H' = -\sum_{i=1}^S p_i \ln(p_i)
$$

### Agregação
#### Índice de Morisita
Mede o padrão de distribuição espacial das espécies. Valores \(I_\delta > 1\) indicam agregação, \(I_\delta = 1\) distribuição ao acaso, e \(I_\delta < 1\) distribuição uniforme.

$$
I_\delta = \frac{n \sum_{i=1}^S n_i (n_i - 1)}{N (N - 1)}
$$

### Estrutura vertical
#### Posição Sociológica Absoluta
Representa a distribuição vertical de uma espécie na comunidade, considerando a contribuição proporcional das classes de altura.
$$
PSA_i = \sum_{j=1}^{J}\left(\frac{N_j}{N} \cdot N_{ij}\right)
$$

#### Posição Sociológica Relativa
É a proporção da posição sociológica absoluta de uma espécie (\(PSA_i\)) em relação à soma das posições sociológicas absolutas de todas as espécies, expressa em porcentagem. Indica a importância relativa da espécie na estrutura vertical.
$$
PSR_i = \frac{PSA_i}{\sum_{i=1}^{S} PSA_i} \cdot 100
$$

#### Valor de Importância Absoluta (Horizontal + Vertical)
Combina os índices horizontais (densidade relativa, dominância relativa e frequência relativa) com a posição sociológica absoluta para refletir a contribuição global de uma espécie na comunidade.
$$
VI_a = DR_i + DoR_i + FR_i + PSA_i
$$

#### Valor de Importância Relativa (Horizontal + Vertical)
É a média ponderada dos índices horizontais e verticais. Indica a importância relativa de uma espécie considerando a estrutura horizontal e vertical.
$$
VI_r = \frac{DR_i + DoR_i + FR_i + PSA_i}{4}
$$

### Regeneração
Pode-se usar os mesmos índices anteriores de estrutura horizontal, vertical, etc. O resultado final será o Indicador de Regeneração Natural que poderá ser usado para calcular o **Valor de Importância Ampliado**:
$$
VIA_r = \frac{DR_i + DoR_i + FR_i + PSA_i + RN_i}{5}
$$

## Fitossociologia (Aplicação)

De acordo com o estudo realizado por Verly et al. (2020), a caracterização florística defina para a Reserva Legal do IFMT foi de um fragmento Cerradão em estado de conservação adequada.


Dados exemplo:
[Baixar dados](data/Dados_Reserva_Exemplo.xlsx)

```{r, echo=FALSE, message=FALSE, warning=FALSE}
library(readxl)
library(kableExtra)
library(dplyr)
library(data.table)
library(DT)

BD <- read_excel("data/Dados_Reserva_Exemplo.xlsx")



if (knitr::is_html_output()) {
  datatable(BD, options = list(columnDefs = list(list(orderable = FALSE, targets = "_all"))))
}

# Exibir tabela estática formatada para PDF
if (knitr::is_latex_output()) {
  knitr::kable(BD, format = "latex", booktabs = TRUE) %>%
    kable_styling(latex_options = c("striped", "scale_down")) %>%
    column_spec(1, width = "3cm") %>%
    column_spec(2, width = "5cm") %>%
    landscape()

}
```
<br>

### Consistência dos dados
Antes de qualquer análise, é fundamental verificar a consistência dos dados coletados. Isso envolve identificar e corrigir possíveis erros ou inconsistências, garantindo a qualidade e a confiabilidade das informações para as análises subsequentes.
```{r}
items_excluir <- c("SP", "Morta", "PP", "PS", "Repetida", "Repitida", "Morfoespécie 7", "Morfoespécie 8")
BD_ <- BD[!BD$`Nome Científico` %in% items_excluir, ]

BD_$DAP <- as.numeric(BD_$DAP)
BD_$`H T` <- as.numeric(BD_$`H T`)
```

### Distribuição diamétrica geral
A análise da distribuição dos diâmetros das árvores fornece insights sobre a estrutura etária e o desenvolvimento da floresta. Uma distribuição equilibrada indica uma regeneração contínua, enquanto a predominância de árvores em determinadas classes diamétricas pode sugerir distúrbios ou práticas de manejo específicas.
```{r}
intervalo <- 5
min_d <- floor(min(BD_$DAP, na.rm = TRUE))
max_d <- ceiling(max(BD_$DAP, na.rm = TRUE))
intervalos <- seq(0, max_d + intervalo, by = intervalo)
hist(BD_$DAP, breaks = intervalos, main = NULL, xlab = "Diâmetro (cm)", ylab = "Frequência")
```
<br>

### Distribuição por espécies (boxplots)
Os boxplots permitem visualizar a variação dos diâmetros por espécie, destacando tendências e identificando outliers. Essa análise auxilia na compreensão do crescimento e do desenvolvimento de cada espécie, bem como na identificação de espécies que possam necessitar de atenção especial no manejo.

#### Boxplot dos DAPs
```{r}
require(ggplot2)
especies <- unique(BD_$`Nome Científico`)

p <- ggplot(BD_, aes(x = reorder(`Nome Científico`, DAP, median), y = DAP, fill = `Nome Científico`)) +
  geom_boxplot(outlier.shape = NA) +  # Boxplot sem os outliers
  theme_minimal(base_size = 10) +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1, size = 6),
    legend.position = "none"  # Remover legenda, se preferir
  ) +
  labs(title = "Distribuição dos DAPs por Espécie", 
       x = "Espécies", y = "DAP (cm)")

print(p)
```

#### boxplot das alturas totais

```{r}

p <- ggplot(BD_, aes(x = reorder(`Nome Científico`, `H T`, median), y = `H T`, fill = `Nome Científico`)) +
  geom_boxplot(outlier.shape = NA) +  # Boxplot sem os outliers
  theme_minimal(base_size = 10) +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1, size = 6),
    legend.position = "none"  # Remover legenda, se preferir
  ) +
  labs(title = "Distribuição das HTs por Espécie", 
       x = "Espécies", y = "HT (m)")

print(p)
```
<br>

### Parâmetros Fitossociológicos
A aplicação prática dos parâmetros fitossociológicos, como densidade, dominância e frequência, fornece uma visão detalhada da composição e da estrutura da comunidade vegetal. Esses indicadores são essenciais para o planejamento de ações de manejo, conservação e recuperação de áreas florestais.

#### Estrutura horizontal

```{r}

EH <- function(species, sample, d, A) {
    DT <- data.table(species = species, sample = sample, d = d)
    DT <- DT[, `:=`(gi = pi * d^2 / 40000)]
    Ui <- unique(DT, by = c("species", "sample"))[, .(Ui = .N), by = "species"]
    ni <- DT[, .(ni = .N, Gi = sum(gi)), by = "species"]
    ni <- ni[Ui, on = "species"]
    ni[, DAi := ni / A][, DRi := (DAi / sum(DAi)) * 100]
    ni[, DoAi := Gi / A][, DoRi := (DoAi / sum(DoAi)) * 100]
    ni[, FAi := (Ui / length(unique(DT$sample))) * 100][, FRi := (FAi / sum(FAi)) * 100]

    num_cols <- names(ni)[sapply(ni, is.numeric)]
    ni[, (num_cols) := lapply(.SD, round, 4), .SDcols = num_cols]

    setnames(ni, old = "species", new = "Espécies")

    return(ni)
}

EH_result <- EH(BD_$`Nome Científico`, BD_$Parc, BD_$DAP, A = 0.8)
```
Resultados:

```{r, echo=FALSE, message=FALSE, warning=FALSE}

# Para HTML: Tabela interativa
if (knitr::is_html_output()) {
  datatable(
    EH_result, 
    options = list(
      scrollX = TRUE,                             # Ativar scroll horizontal
      columnDefs = list(
        list(orderable = FALSE, targets = "_all"),# Desativar ordenação em todas as colunas
        list(className = "dt-center", targets = "_all") # Centralizar conteúdo
      ),
      pageLength = 10                             # Exibir 10 linhas por página
    )
  )
}

# Para PDF: Tabela estática formatada
if (knitr::is_latex_output()) {
  knitr::kable(EH_result, format = "latex", booktabs = TRUE) %>%
    kable_styling(latex_options = c("striped", "scale_down")) %>%
    column_spec(1, width = "3cm") %>%
    column_spec(2, width = "5cm") %>%
    landscape()
}
```
<br>

#### Índice de Shannon (Diversidade)
Na aplicação, o cálculo do índice de Shannon avalia a diversidade alfa da comunidade vegetal. Um valor alto reflete maior diversidade e distribuição equitativa entre as espécies no local estudado.

```{r}
shannon <- function(species_counts) {
  pi <- species_counts / sum(species_counts)
  -sum(pi * log(pi), na.rm = TRUE)
}

H <- shannon(EH_result$ni)
cat("Índice de Shannon:", H, "\n")

```
#### Índice de Morisita (Agregação)
Mede o padrão de distribuição espacial das espécies. Valores \(I_\delta > 1\) indicam agregação.

```{r}
morisita <- function(species_counts, parcelas) {
  # Agregar os indivíduos por parcela
  counts <- tapply(species_counts, parcelas, sum)
  
  N <- sum(counts)       # Total de indivíduos em todas as parcelas
  n <- length(counts)    # Número de parcelas
  numerator <- n * sum(counts * (counts - 1))  # Soma dos xi(xi - 1) por parcela
  denominator <- N * (N - 1)                   # Total de combinações possíveis
  I_M <- numerator / denominator
  return(I_M)
}

# Exemplo de aplicação:
# Substituir species_counts e parcelas pelos dados reais
species_counts <- BD_$DAP[!is.na(BD_$DAP)]  # DAP como proxy de presença/indivíduo
parcelas <- BD_$Parc                       # Número da parcela correspondente
I_delta <- morisita(species_counts, parcelas)
cat("Índice de Morisita corrigido:", I_delta, "\n")


```
#### Estrutura vertical e classificação em estratos
A inclusão da dimensão vertical nos parâmetros fitossociológicos agrega uma visão tridimensional da comunidade florestal, indo além da análise convencional baseada apenas na densidade e dominância (horizontal).

```{r}
BD_$`H T` <- as.numeric(BD_$`H T`)
meanH <- mean(BD_$`H T`, na.rm = TRUE)
sdH <- sd(BD_$`H T`, na.rm = TRUE)

# Calcular estrato
BD_$estrato <- case_when(
  BD_$`H T` < (meanH - sdH) ~ "Inferior",
  BD_$`H T` >= (meanH - sdH) & BD_$`H T` <= (meanH + sdH) ~ "Médio",
  BD_$`H T` > (meanH + sdH) ~ "Superior"
)

# Calcular PSAi e PSRi
resultados <- BD_ %>%
  group_by(estrato) %>%
  mutate(
    Nj = n(),                     # Total de indivíduos no estrato
    N = nrow(BD_),                # Total de indivíduos na floresta
    Pj = Nj / N                   # Peso do estrato no total
  ) %>%
  group_by(`Nome Científico`, estrato) %>%
  summarise(
    Nji = n(),                    # Número de indivíduos da espécie no estrato
    Nj = first(Nj),               # Total de indivíduos no estrato
    Pj = first(Pj),               # Peso do estrato
    PSAi_partial = (Nji / Nj) * Pj, # Contribuição parcial para PSAi
    .groups = "drop"
  ) %>%
  group_by(`Nome Científico`) %>%
  summarise(
    PSAi = sum(PSAi_partial, na.rm = TRUE)        # Soma das contribuições parciais para PSAi
  ) %>%
  ungroup() %>%
  mutate(
    PSRi = (PSAi / sum(PSAi, na.rm = TRUE)) * 100 # PSRi como porcentagem global
  )

# Fusão das tabelas com left_join
EH_result <- EH_result %>%
  left_join(resultados, by = c("Espécies" = "Nome Científico"))

# Adicionando o Valor de Importância Ampliado (VIA)
required_cols <- c("DAi", "DoAi", "FAi", "PSAi", "DRi", "DoRi", "FRi", "PSRi")
missing_cols <- required_cols[!required_cols %in% names(EH_result)]

if (length(missing_cols) > 0) {
  stop(paste("Colunas ausentes em `EH_result`: ", paste(missing_cols, collapse = ", ")))
}

EH_result <- EH_result %>%
  mutate(
    VIAa = (DAi + DoAi + FAi + PSAi) / 4,  # Cálculo do VIA absoluto
  )

# Visualizar os resultados finais com arredondamento
resultado_final <- EH_result %>%
  arrange(desc(VIAa)) %>%
  mutate(across(where(is.numeric), round, 4))


```

```{r, echo=FALSE, message=FALSE, warning=FALSE}

# Para HTML: Tabela interativa
if (knitr::is_html_output()) {
  datatable(
    resultado_final, 
    options = list(
      scrollX = TRUE,                             # Ativar scroll horizontal
      columnDefs = list(
        list(orderable = FALSE, targets = "_all"),# Desativar ordenação em todas as colunas
        list(className = "dt-center", targets = "_all") # Centralizar conteúdo
      ),
      pageLength = 10                             # Exibir 10 linhas por página
    )
  )
}

# Para PDF: Tabela estática formatada
if (knitr::is_latex_output()) {
  knitr::kable(resultado_final, format = "latex", booktabs = TRUE) %>%
  kable_styling(latex_options = c("striped", "scale_down")) %>%
  column_spec(1, width = "3cm") %>%
  column_spec(2, width = "5cm") %>%
  landscape()

}
```
<br>
Na aplicação prática, a utilização do VIA, que combina parâmetros horizontais e verticais com indicadores de regeneração, fornece uma visão holística da importância das espécies. Isso é fundamental para identificar não apenas as espécies dominantes atuais, mas também aquelas com maior potencial de contribuir para a sustentabilidade futura do ecossistema.

**Referências**
<br>